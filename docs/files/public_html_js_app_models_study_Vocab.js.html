<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>public_html\js\app\models\study\Vocab.js - Skritter HTML5: Documentation</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="Skritter HTML5: Documentation"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.0.334</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/Assets.html">Assets</a></li>
            
                <li><a href="../classes/Canvas.html">Canvas</a></li>
            
                <li><a href="../classes/CanvasCharacter.html">CanvasCharacter</a></li>
            
                <li><a href="../classes/CanvasStroke.html">CanvasStroke</a></li>
            
                <li><a href="../classes/ContainedTable.html">ContainedTable</a></li>
            
                <li><a href="../classes/Decomp.html">Decomp</a></li>
            
                <li><a href="../classes/Decomps.html">Decomps</a></li>
            
                <li><a href="../classes/DecompTable.html">DecompTable</a></li>
            
                <li><a href="../classes/Functions.html">Functions</a></li>
            
                <li><a href="../classes/GradingButtons.html">GradingButtons</a></li>
            
                <li><a href="../classes/HomeView.html">HomeView</a></li>
            
                <li><a href="../classes/Item.html">Item</a></li>
            
                <li><a href="../classes/Items.html">Items</a></li>
            
                <li><a href="../classes/LeapController.html">LeapController</a></li>
            
                <li><a href="../classes/Libraries.html">Libraries</a></li>
            
                <li><a href="../classes/Log.html">Log</a></li>
            
                <li><a href="../classes/Mauler.html">Mauler</a></li>
            
                <li><a href="../classes/Modal.html">Modal</a></li>
            
                <li><a href="../classes/OptionsView.html">OptionsView</a></li>
            
                <li><a href="../classes/Param.html">Param</a></li>
            
                <li><a href="../classes/Params.html">Params</a></li>
            
                <li><a href="../classes/PinyinConverter.html">PinyinConverter</a></li>
            
                <li><a href="../classes/PromptData.html">PromptData</a></li>
            
                <li><a href="../classes/PromptDefn.html">PromptDefn</a></li>
            
                <li><a href="../classes/PromptItem.html">PromptItem</a></li>
            
                <li><a href="../classes/PromptRdng.html">PromptRdng</a></li>
            
                <li><a href="../classes/PromptRune.html">PromptRune</a></li>
            
                <li><a href="../classes/PromptTone.html">PromptTone</a></li>
            
                <li><a href="../classes/Recognizer.html">Recognizer</a></li>
            
                <li><a href="../classes/Review.html">Review</a></li>
            
                <li><a href="../classes/Reviews.html">Reviews</a></li>
            
                <li><a href="../classes/ReviewsView.html">ReviewsView</a></li>
            
                <li><a href="../classes/Router.html">Router</a></li>
            
                <li><a href="../classes/Scheduler.html">Scheduler</a></li>
            
                <li><a href="../classes/Sentence.html">Sentence</a></li>
            
                <li><a href="../classes/Sentences.html">Sentences</a></li>
            
                <li><a href="../classes/Settings.html">Settings</a></li>
            
                <li><a href="../classes/Shortstraw.html">Shortstraw</a></li>
            
                <li><a href="../classes/SimpTradMap.html">SimpTradMap</a></li>
            
                <li><a href="../classes/SRSConfigs.html">SRSConfigs</a></li>
            
                <li><a href="../classes/Stopwatch.html">Stopwatch</a></li>
            
                <li><a href="../classes/Stroke.html">Stroke</a></li>
            
                <li><a href="../classes/Strokes.html">Strokes</a></li>
            
                <li><a href="../classes/StudyView.html">StudyView</a></li>
            
                <li><a href="../classes/Sync.html">Sync</a></li>
            
                <li><a href="../classes/Tests.html">Tests</a></li>
            
                <li><a href="../classes/Timer.html">Timer</a></li>
            
                <li><a href="../classes/User.html">User</a></li>
            
                <li><a href="../classes/Vocab.html">Vocab</a></li>
            
                <li><a href="../classes/VocabInfoView.html">VocabInfoView</a></li>
            
                <li><a href="../classes/VocabList.html">VocabList</a></li>
            
                <li><a href="../classes/VocabListRowsTable.html">VocabListRowsTable</a></li>
            
                <li><a href="../classes/VocabListSection.html">VocabListSection</a></li>
            
                <li><a href="../classes/VocabListSectionsTable.html">VocabListSectionsTable</a></li>
            
                <li><a href="../classes/VocabListsTable.html">VocabListsTable</a></li>
            
                <li><a href="../classes/VocabListsView.html">VocabListsView</a></li>
            
                <li><a href="../classes/Vocabs.html">Vocabs</a></li>
            
                <li><a href="../classes/VocabsView.html">VocabsView</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/Collection.html">Collection</a></li>
            
                <li><a href="../modules/Component.html">Component</a></li>
            
                <li><a href="../modules/Components.html">Components</a></li>
            
                <li><a href="../modules/Model.html">Model</a></li>
            
                <li><a href="../modules/Skritter.html">Skritter</a></li>
            
                <li><a href="../modules/Views.html">Views</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: public_html\js\app\models\study\Vocab.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
 * @module Skritter
 * @submodule Model
 * @param CanvasCharacter
 * @param CanvasStroke
 * @param PinyinConverter
 * @author Joshua McFarland
 */
define([
    &#x27;collections/CanvasCharacter&#x27;,
    &#x27;models/CanvasStroke&#x27;,
    &#x27;PinyinConverter&#x27;
], function(CanvasCharacter, CanvasStroke, PinyinConverter) {
    /**
     * @class Vocab
     */
    var Vocab = Backbone.Model.extend({
        /**
         * @method cache
         * @param {Function} callback
         */
        cache: function(callback) {
            skritter.storage.setItems(&#x27;vocabs&#x27;, this.toJSON(), function() {
                if (typeof callback === &#x27;function&#x27;)
                    callback();
            });
        },
        /**
         * @method getCanvasCharacters
         * @param {Number} index
         * @param {String} part
         * @return {Array}
         */
        getCanvasCharacters: function(index, part) {
            var characters = [];
            var variations = [];
            var tones = null;
            var rune = this.getCharacters()[index - 1];
            if (part === &#x27;tone&#x27;) {
                tones = this.getReadingAt(index).tones;
                if (tones)
                    for (var i in tones)
                        variations.push(skritter.data.strokes.get(&#x27;tone&#x27; + tones[i]).get(&#x27;strokes&#x27;));
            } else {
                var strokeData = skritter.data.strokes.get(rune);
                if (strokeData)
                    variations = strokeData.get(&#x27;strokes&#x27;);
            }
            for (var v in variations) {
                var character = new CanvasCharacter();
                var strokes = variations[v];
                var position = 1;
                for (var s in strokes) {
                    var stroke = new CanvasStroke();
                    var bitmapId = parseInt(strokes[s][0], 10);
                    var params = skritter.data.params.findWhere({bitmapId: bitmapId});
                    character.name = (part === &#x27;rune&#x27;) ? rune : &#x27;tone&#x27; + tones[v];
                    stroke.set({
                        bitmapId: bitmapId,
                        data: strokes[s],
                        id: position + &#x27;|&#x27; + bitmapId,
                        part: part,
                        position: position,
                        sprite: skritter.assets.getStroke(bitmapId)
                    });
                    if (params.has(&#x27;contains&#x27;)) {
                        stroke.set(&#x27;contains&#x27;, params.get(&#x27;contains&#x27;));
                        position++;
                    }
                    position++;
                    character.add(stroke);
                }
                characters.push(character);
            }
            return characters;
        },
        getCharacterCount: function() {
            return this.getCharacters().length;
        },
        getCharacters: function(includeSpecial) {
            return this.get(&#x27;writing&#x27;).split(&#x27;&#x27;).filter(function(character) {
                if (includeSpecial)
                    return character;
                return !skritter.fn.isKana(character);
            });
        },
        getContainedItems: function(part) {
            var containedItems = [];
            var containedVocabIds = this.get(&#x27;containedVocabIds&#x27;);
            if (containedVocabIds) {
                for (var i in containedVocabIds) {
                    var containedItemId = null;
                    if (part === &#x27;rune&#x27;) {
                        containedItemId = skritter.user.get(&#x27;user_id&#x27;) + &#x27;-&#x27; + containedVocabIds[i] + &#x27;-&#x27; + part;
                    } else {
                        containedItemId = skritter.user.get(&#x27;user_id&#x27;) + &#x27;-&#x27; + containedVocabIds[i] + &#x27;-&#x27; + part;
                        containedItemId =  containedItemId.split(&#x27;-&#x27;);
                        containedItemId[3] = &#x27;0&#x27;;
                        containedItemId = containedItemId.join(&#x27;-&#x27;);
                    }
                    var containedItem = skritter.data.items.get(containedItemId);
                    if (containedItem)
                        containedItems.push(containedItem);
                }
            }
            return containedItems;
        },
        getDecomps: function(returnDuplicates) {
            if (this.getCharacterCount() &gt; 1)
                return false;
            var writings = [];
            var decomp = skritter.data.decomps.get(this.getCharacters()[0]);
            if (decomp &amp;&amp; decomp.has(&#x27;atomic&#x27;)) {
                var children = decomp.get(&#x27;Children&#x27;);
                if (returnDuplicates)
                    return children;
                return children.filter(function(child) {
                    for (var i in writings)
                        if (writings[i] === child.writing)
                            return false;
                    writings.push(child.writing);
                    return true;
                });
            }
        },
        getDefinition: function() {
            //TODO: allow for definition images with proper css styling
            //.replace(/img:(http:\/\/\S+)/gi, &#x27;&lt;img src=&quot;$1&quot;/&gt;&#x27;)
            //.replace(/_([^ _][^_]*)_(?!\S{4})/gi, &#x27;&lt;em&gt;$1&lt;/em&gt;&#x27;)
            //.replace(/\n/gi, &#x27;&lt;br/&gt;&#x27;)
            //.replace(/\*([^*]+)\*/gi, &#x27;&lt;b&gt;$1&lt;/b&gt;&#x27;);
            var definition = this.get(&#x27;definitions&#x27;)[skritter.user.getSetting(&#x27;sourceLang&#x27;)];
            if (typeof definition === undefined)
                definition = this.get(&#x27;definitions&#x27;).en;
            if (definition)
                return definition.replace(/img:(http:\/\/\S+)/gi, &#x27;&#x27;);
            return null;
        },
        /**
         * @method getFontName
         * @returns {String}
         */
        getFontName: function() {
            if (this.get(&#x27;lang&#x27;) === &#x27;zh&#x27;)
                return &#x27;simkai&#x27;;
            return &#x27;kaisho&#x27;;
        },
        getReading: function() {
            return PinyinConverter.toTone(this.get(&#x27;reading&#x27;));
        },
        /**
         * Gets a broken down reading object based on its position in the character if its
         * more than a single character item.
         * 
         * @method getReadingAt
         * @param {Number} position
         * @returns {Object}
         */
        getReadingAt: function(position) {
            var reading, syllable, tones;
            position = (position &gt; 1) ? position - 1 : 0;
            reading = this.get(&#x27;reading&#x27;).toLowerCase().replace(&#x27; ... &#x27;, &#x27;&#x27;).replace(&quot;&#x27;&quot;, &#x27;&#x27;);
            if (this.getCharacterCount() === 1) {
                syllable = reading.replace(/[0-9]+/g, &#x27;&#x27;).replace(/\s/g, &#x27;&#x27;).split(&#x27;,&#x27;);
                tones = reading.replace(/[a-z]+/g, &#x27;&#x27;).replace(/\s/g, &#x27;&#x27;).split(&#x27;,&#x27;).map(function(tone) {
                    return parseInt(tone, 10);
                });
                return {reading: reading, syllable: syllable, tones: tones};
            }
            syllable = _.without(reading.split(/[0-9]+/g), &#x27;&#x27;)[position].split(&#x27;,&#x27;);
            tones = _.without(reading.split(/[a-z]+/g), &#x27;&#x27;)[position].split(&#x27;,&#x27;).map(function(tone) {
                return parseInt(tone, 10);
            });
            return {reading: syllable + tones, syllable: syllable, tones: tones};
        },
        /**
         * @method getReadingHTML
         * @param {Number} position
         * @param {Boolean} reveal
         * @param {Boolean} hidden
         * @returns {DOMElement}
         */
        getReadingDisplay: function(position, reveal, hidden) {
            var element = &#x27;&#x27;;
            var characterCount = this.getCharacterCount();
            element += &quot;&lt;div class=&#x27;prompt-reading-display&#x27;&gt;&quot;;
            for (var i = 1; i &lt;= characterCount; i++) {
                if (hidden) {
                    if (position &gt; i) {
                        element += &quot;&lt;span id=&#x27;reading-&quot; + i + &quot;&#x27; class=&#x27;prompt-reading-show&#x27;&gt;&quot; + PinyinConverter.toTone(this.getReadingAt(i).reading) + &quot;&lt;/span&gt;&quot;;
                    } else {
                        element += &quot;&lt;span id=&#x27;reading-&quot; + i + &quot;&#x27; class=&#x27;btn btn-default btn-xs hidden-reading&#x27;&gt;show&lt;/span&gt;&quot;;
                        break;
                    }
                } else {
                    if (position &gt; i) {
                        element += &quot;&lt;span id=&#x27;reading-&quot; + i + &quot;&#x27; class=&#x27;prompt-reading-show&#x27;&gt;&quot; + PinyinConverter.toTone(this.getReadingAt(i).reading) + &quot;&lt;/span&gt;&quot;;
                    } else if (position === i &amp;&amp; reveal) {
                        element += &quot;&lt;span id=&#x27;reading-&quot; + i + &quot;&#x27; class=&#x27;prompt-reading-hide&#x27;&gt;&quot; + PinyinConverter.toTone(this.getReadingAt(i).reading) + &quot;&lt;/span&gt;&quot;;
                    } else if (position === i) {
                        element += &quot;&lt;span id=&#x27;reading-&quot; + i + &quot;&#x27; class=&#x27;prompt-reading-hide&#x27;&gt;&quot; + this.getReadingAt(i).syllable + &quot;&lt;/span&gt;&quot;;
                    } else {
                        element += &quot;&lt;span id=&#x27;reading-&quot; + i + &quot;&#x27; class=&#x27;prompt-reading-show&#x27;&gt;&quot; + this.getReadingAt(i).syllable + &quot;&lt;/span&gt;&quot;;
                    }
                }
            }
            element += &quot;&lt;/div&gt;&quot;;
            return element;
        },
        getSentence: function() {
            var sentence = skritter.data.sentences.findWhere({id: this.get(&#x27;sentenceId&#x27;)});
            return (sentence) ? sentence : null;
        },
        /**
         * @method getTextStyleClass
         * @returns {String}
         */
        getTextStyleClass: function() {
            if (this.get(&#x27;lang&#x27;) === &#x27;zh&#x27;)
                return &#x27;chinese-text&#x27;;
            return &#x27;japanese-text&#x27;;
        },
        /**
         * @method getWritingHTML
         * @param {Number} position
         * @returns {DOMElement}
         */
        getWritingDisplay: function(position) {
            position = (position) ? position - 1 : 0;
            var element = &#x27;&#x27;;
            var characterPosition = 0;
            var characters = this.getCharacters(true);
            element += &quot;&lt;div class=&#x27;prompt-writing-display&#x27;&gt;&quot;;
            for (var i = 0; i &lt; characters.length; i++) {
                if (skritter.fn.isKana(characters[i])) {
                    element += &quot;&lt;span id=&#x27;writing-&quot; + i + &quot;&#x27; class=&#x27;prompt-writing-show&#x27;&gt;&quot; + characters[i] + &quot;&lt;/span&gt;&quot;;
                } else {
                    if (position &gt; characterPosition) {
                        element += &quot;&lt;span id=&#x27;writing-&quot; + i + &quot;&#x27; class=&#x27;prompt-writing-show&#x27;&gt;&quot; + characters[i] + &quot;&lt;/span&gt;&quot;;
                    } else {
                        element += &quot;&lt;span class=&#x27;prompt-underline&#x27;&gt;&lt;span id=&#x27;writing-&quot; + i + &quot;&#x27; class=&#x27;prompt-writing-hide&#x27;&gt;&quot; + characters[i] + &quot;&lt;/span&gt;&lt;/span&gt;&quot;;
                    }
                    characterPosition++;
                }
            }
            element += &quot;&lt;/div&gt;&quot;;
            return element;
        },
        /**
         * Loads and returns the contained items as a callback based on the specified 
         * part and contained vocab ids.
         * 
         * @method loadContainedItems
         * @param {String} part
         * @param {Function} callback
         */
        loadContainedItems: function(part, callback) {
            var containedVocabIds = this.get(&#x27;containedVocabIds&#x27;);
            if (containedVocabIds) {
                var containedItemIds = [];
                for (var i in containedVocabIds)
                    if (part === &#x27;rune&#x27;) {
                        containedItemIds.push(skritter.user.get(&#x27;user_id&#x27;) + &#x27;-&#x27; + containedVocabIds[i] + &#x27;-&#x27; + part);
                    } else {
                        var containedItemId = null;
                        containedItemId = skritter.user.get(&#x27;user_id&#x27;) + &#x27;-&#x27; + containedVocabIds[i] + &#x27;-&#x27; + part;
                        containedItemId = containedItemId.split(&#x27;-&#x27;);
                        containedItemId[3] = &#x27;0&#x27;;
                        containedItemId = containedItemId.join(&#x27;-&#x27;);
                        containedItemIds.push(containedItemId);
                    }
                skritter.storage.getItems(&#x27;items&#x27;, containedItemIds, function(items) {
                    callback(skritter.data.items.add(items, {merge: true, silent: true}));
                });
            } else {
                callback([]);
            }
        },
        /**
         * @method loadContainedVocabs
         * @param {Function} callback
         */
        loadContainedVocabs: function(callback) {
            var containedVocabIds = this.get(&#x27;containedVocabIds&#x27;);
            if (containedVocabIds) {
                skritter.storage.getItems(&#x27;vocabs&#x27;, containedVocabIds, function(vocabs) {
                    callback(skritter.data.vocabs.add(vocabs, {merge: true, silent: true}));
                });
            } else {
                callback([]);
            }
        },
        /**
         * @method play
         */
        play: function() {
            if (this.has(&#x27;audio&#x27;))
                skritter.assets.getAudio(this.get(&#x27;audio&#x27;).replace(&#x27;/sounds?file=&#x27;, &#x27;&#x27;));
        },
        /**
         * @method spawnVirtualItems
         * @param {Array} parts
         * @returns {Backbone.Collection}
         */
        spawnVirtualItems: function(parts) {
            if (this.get(&#x27;lang&#x27;) === &#x27;zh&#x27;) {
                parts = (parts) ? parts : [&#x27;defn&#x27;, &#x27;rdng&#x27;, &#x27;rune&#x27;, &#x27;tone&#x27;];
            } else {
                parts = (parts) ? parts : [&#x27;defn&#x27;, &#x27;rdng&#x27;, &#x27;rune&#x27;];
            }
            var items = [];
            var vocabId = this.get(&#x27;id&#x27;);
            for (var i in parts)
                items.push(new StudyItem({
                    id: skritter.user.get(&#x27;user_id&#x27;) + &#x27;-&#x27; + vocabId + &#x27;-&#x27; + parts[i],
                    part: parts[i],
                    reviews: 0,
                    vocabIds: [vocabId]
                }));
            return items;
        }
    });

    return Vocab;
}); 
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
